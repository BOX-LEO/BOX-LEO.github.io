<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Our Song</title>
  <style>
    :root{
      --bg:#0b0f1a;
      --card:#121a2a;
      --text:#e8eefc;
      --muted:#aab6d3;
      --accent:#ff7eb3;
      --line:rgba(255,255,255,.08);
    }
    *{ box-sizing:border-box; }

    @keyframes gradientFlow {
      0% {
        background-position: 0% 50%;
      }
      50% {
        background-position: 100% 50%;
      }
      100% {
        background-position: 0% 50%;
      }
    }

    body{
      margin:0;
      min-height:100vh;
      color:var(--text);
      background: url('assets/background.JPG') center center / cover no-repeat fixed;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.5);
      pointer-events: none;
      z-index: -1;
    }
    .wrap{
      max-width:640px;
      margin:0 auto;
      padding:28px 16px 40px;
      display:grid;
      gap:16px;
      grid-template-columns: 1fr;
    }
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius:18px;
      padding:18px;
      box-shadow: 0 20px 60px rgba(0,0,0,.35);
    }
    .card.top{
      padding:18px 14px;
    }
    header{
      display:flex;
      flex-direction:column;
      gap:8px;
      align-items:center;
      text-align:center;
    }
    .title{
      display:flex;
      flex-direction:column;
      gap:6px;
      align-items:center;
    }
    h1{
      margin:0;
      font-size:26px;
      letter-spacing:.3px;
    }
    .sub{
      margin:0;
      color:var(--muted);
      font-size:13px;
      line-height:1.4;
    }

    .top{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:14px;
    }

    .cover{
      display:none;
    }

    .lyrics-wrapper{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:14px;
      width:100%;
      max-width:600px;
    }

    .controls{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:center;
      flex-wrap:wrap;
    }
    button{
      appearance:none;
      border:1px solid var(--line);
      background:rgba(255,255,255,.06);
      color:var(--text);
      padding:10px 14px;
      border-radius:12px;
      cursor:pointer;
      font-weight:600;
      letter-spacing:.2px;
    }
    button:hover{ border-color:rgba(255,255,255,.18); }
    button:active{ transform: translateY(1px); }

    .pill{
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      color:var(--muted);
      font-size:12px;
      background:rgba(0,0,0,.12);
    }

    .row{
      display:flex;
      align-items:center;
      gap:10px;
      width:100%;
    }
    input[type="range"]{
      width:100%;
      accent-color: var(--accent);
    }
    .time{
      font-variant-numeric: tabular-nums;
      color:var(--muted);
      font-size:12px;
      min-width:92px;
      text-align:right;
    }

    .lyrics{
      height:420px;
      width:100%;
      overflow:auto;
      border-radius:16px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.12);
      padding:60px 12px;
      scrollbar-width:none;
      -ms-overflow-style:none;
      -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 15%, black 85%, transparent 100%);
      mask-image: linear-gradient(to bottom, transparent 0%, black 15%, black 85%, transparent 100%);
    }
    .lyrics::-webkit-scrollbar{
      display:none;
    }
    .line{
      padding:10px 10px;
      border-radius:12px;
      color:var(--muted);
      cursor:pointer;
      user-select:none;
      line-height:1.35;
      text-align:center;
      transition: background .3s, color .3s, transform .3s, opacity .4s;
      opacity: 0.4;
    }
    .line:hover{
      background:rgba(255,255,255,.05);
      color:rgba(232,238,252,.9);
      opacity: 0.8;
    }
    .line.active{
      background:rgba(255,126,179,.16);
      color:var(--text);
      border:1px solid rgba(255,126,179,.35);
      transform: scale(1.05);
      opacity: 1;
    }
    .line.near-1{
      opacity: 0.75;
    }
    .line.near-2{
      opacity: 0.55;
    }

    .footer{
      color:var(--muted);
      font-size:12px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    a{ color:var(--accent); text-decoration:none; }
    a:hover{ text-decoration:underline; }

    /* Fixed bottom player bar */
    .player-bar{
      position:fixed;
      bottom:16px;
      left:50%;
      transform:translateX(-50%);
      width:calc(100% - 32px);
      max-width:640px;
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius:18px;
      padding:14px 18px;
      backdrop-filter:blur(16px);
      -webkit-backdrop-filter:blur(16px);
      z-index:1000;
      box-shadow: 0 20px 60px rgba(0,0,0,.35);
    }
    .player-inner{
      display:flex;
      align-items:center;
      gap:16px;
    }
    .play-btn{
      width:48px;
      height:48px;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      background:var(--accent);
      border:none;
      color:#0b0f1a;
      font-size:18px;
      flex-shrink:0;
      transition: transform .1s, background .15s;
    }
    .play-btn:hover{
      background:#ff9ec4;
      transform:scale(1.05);
    }
    .player-progress{
      flex:1;
      display:flex;
      align-items:center;
      gap:12px;
      min-width:0;
    }
    .player-progress input[type="range"]{
      flex:1;
      min-width:80px;
    }
    .player-time{
      font-variant-numeric: tabular-nums;
      color:var(--muted);
      font-size:12px;
      min-width:90px;
      text-align:center;
    }
    .player-volume{
      display:flex;
      align-items:center;
      gap:8px;
      flex-shrink:0;
    }
    .player-volume input[type="range"]{
      width:80px;
    }
    .vol-icon{
      color:var(--muted);
      cursor:pointer;
      width:18px;
      height:18px;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-shrink:0;
    }
    .vol-icon svg{
      display:block;
    }
    @media (max-width: 600px){
      .player-inner{
        flex-wrap:wrap;
        gap:12px;
      }
      .player-progress{
        order:3;
        width:100%;
      }
      .player-volume input[type="range"]{
        width:50px;
      }
    }
    body{
      padding-bottom:90px;
    }
  </style>
</head>
<div id="particles-js" style="position:fixed; inset:0; z-index:-1;"></div>

<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
<script>
particlesJS("particles-js", {
  particles: {
    number: { value: 70 },
    size: { value: 2 },
    move: { speed: 1 },
    line_linked: { enable: true, opacity: 0.2 }
  }
});
</script>

<body>
  <div class="wrap">
    <div class="card">
      <header>
        <div class="title">
          <h1 id="songTitle">Our Song</h1>
          <p class="sub" id="songSub">A small website to play one song, with rolling lyrics.</p>
        </div>
        <!-- <div class="pill" id="status">Ready</div> -->
      </header>
    </div>

    <div class="card top">
      <div class="lyrics-wrapper">
        <div class="lyrics" id="lyricsBox" aria-label="Rolling lyrics"></div>
        <div class="controls">
          <button id="scrollBtn" type="button">Auto Scroll: On</button>
          <span class="pill" id="hint">Tip: click a lyric line to seek.</span>
        </div>
      </div>
      <!-- Audio element (hidden) -->
      <audio id="audio" preload="metadata">
        <source src="assets/song.mp3" type="audio/mpeg" />
      </audio>
    </div>

    <div class="card footer">
      <div>Host: GitHub Pages. Files: index.html + assets/song.mp3.</div>
      <div>Edit lyrics timestamps inside this file.</div>
    </div>
  </div>

  <!-- Fixed bottom player bar -->
  <div class="player-bar">
    <div class="player-inner">
      <button id="playBtn" class="play-btn" type="button">▶</button>
      <div class="player-progress">
        <input id="seek" type="range" min="0" max="1000" value="0" />
        <div class="player-time" id="timeLabel">0:00 / 0:00</div>
      </div>
      <div class="player-volume">
        <span class="vol-icon" id="volIcon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 5L6 9H2v6h4l5 4V5z"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg></span>
        <input id="vol" type="range" min="0" max="1" step="0.01" value="0.9" />
      </div>
    </div>
  </div>

  <script>
    // ====== 1) EDIT THESE ======
    const META = {
      title: "Code26_214",
      subtitle: "",
    };

    // Timestamps are in seconds.
    // Replace text with your lyrics.
    // Add more lines as you like.
    const LYRICS = [
      { t: 0.0,   text: "..." },
      { t: 11.9,  text: "一直不敢和你对视也不敢say Hi" },
      { t: 14.9,  text: "眼神不停闪躲时间过的飞快" },
      { t: 17.9,  text: "还没和你说话可能注定失败" },
      { t: 20.9,  text: "不知如何挽留你已经准备离开" },
      { t: 23.9,  text: "那天你走后我能量瞬间耗尽" },
      { t: 26.9,  text: "不知你那晚有没有玩的尽兴" },
      { t: 29.9,  text: "明明想靠近但一直犹豫不停" },
      { t: 32.9,  text: "多亏你私信才把我们距离拉近" },
      { t: 35.9,  text: "收到了消息是你夸我超帅" },
      { t: 38.9,  text: "我向你坦白有些心潮澎湃" },
      { t: 41.9,  text: "不想再错过你的每条动态" },
      { t: 44.9,  text: "渐渐开始幻想有彼此的未来" },
      { t: 47.9,  text: "默默关注你的主页不想让你发现" },
      { t: 50.9,  text: "社交媒体给你私信躲在屏幕后面" },
      { t: 53.9,  text: "下次演出尽量出现这是你的留言" },
      { t: 56.9,  text: "无法控制胡思乱想期待下次相见" },
      { t: 59.9,  text: "..." },
      { t: 71.9,  text: "在台上很紧张看到你我就能放心" },
      { t: 74.9,  text: "认识你大半年那天终于加上微信" },
      { t: 77.9,  text: "你身影太迷人瞬间深深刻进心里" },
      { t: 80.9,  text: "不想很快承认面对你我失去自信" },
      { t: 83.9,  text: "听说你会参加之后的聚餐" },
      { t: 86.9,  text: "想象着和你打招呼的画面" },
      { t: 89.9,  text: "很害怕不自觉表现的不安" },
      { t: 92.9,  text: "多希望有机会多看你一眼" },
      { t: 95.9,  text: "时间一天一天终于和你见面" },
      { t: 98.9,  text: "不想被你发现我闪躲的视线" },
      { t: 101.9, text: "给你倒杯橙汁隐藏嘴角弧线" },
      { t: 104.9, text: "游戏加速时间转眼已到三点" },
      { t: 107.9, text: "..." },
      { t: 131.9, text: "那天起我们的沟通和交流都 逐渐变得频繁" },
      { t: 134.9, text: "只想让你尽快了解我不常见 最真实的一面" },
      { t: 137.9, text: "所有话不隐藏不掩饰不说谎 有些口无遮拦" },
      { t: 140.9, text: "不客套不暧昧不刻意不虚伪 希望你能喜欢" },
      { t: 143.9, text: "一直盯着手机屏幕不需要睡觉吃饭" },
      { t: 146.9, text: "精神世界保持共鸣听你推荐的歌单" },
      { t: 149.9, text: "保持真实没有技巧全都靠真情实感" },
      { t: 152.9, text: "可以勇敢做我自己 这就是新的起点" },
      { t: 155.9, text: "Yeah Yeah 话题变得深入" },
      { t: 158.9, text: "Yeah Yeah 心事向你倾诉" },
      { t: 161.9, text: "Yeah Yeah 了解来时的路" },
      { t: 164.9, text: "内心世界丰富-是你特有的天赋" },
      { t: 167.9, text: "早就想说你的眼睛很迷人" },
      { t: 170.9, text: "它装着世间万物和星辰" },
      { t: 173.9, text: "不知不觉为你灵魂沉沦" },
      { t: 176.9, text: "里面是高洁纯净的精神" },
      { t: 179.9, text: "知道你不认路 添加你的findmy" },
      { t: 182.9, text: "不希望有意外 掌握你的动态" },
      { t: 185.9, text: "接送机交给我 航班号都拿来" },
      { t: 188.9, text: "秘密开始策划 把我内心表白" },
      { t: 191.9, text: "..." },
      { t: 215.9, text: "我不会随随便便对待你" },
      { t: 218.9, text: "也不想你受一点点委屈" },
      { t: 221.9, text: "每个未来身边的人是你" },
      { t: 224.9, text: "天南地北哪里都是风景" },
      { t: 227.9, text: "茫茫人海相遇 三生有幸" },
      { t: 230.9, text: "渐渐开始相信 命中注定" },
      { t: 233.9, text: "尊重自己内心 无比确信" },
      { t: 236.9, text: "非你莫属因为我们灵魂相契" },
      { t: 239.9, text: "你有发现美好的眼睛" },
      { t: 242.9, text: "也有温暖世界的心灵" },
      { t: 245.9, text: "你天真浪漫还很理性" },
      { t: 248.9, text: "成熟包裹鲜活温柔且坚定" },
      { t: 251.9, text: "情歌不再肉麻变成生活写照" },
      { t: 254.9, text: "我知道你扫清所有的问号" },
      { t: 257.9, text: "我想要未来都是你的美貌" },
      { t: 260.9, text: "想简简单单爱陪你一直到老" },
      { t: 263.9, text: "今天是我们过的第一个情人节" },
      { t: 266.9, text: "紧紧相拥属于彼此不会有离别" },
      { t: 269.9, text: "清爽透彻自由纯粹保持天真无邪" },
      { t: 272.9, text: "共同书写专属你我甜蜜的情节" },
      { t: 275.9, text: "To My Destined Love" },
      { t: 278.9, text: "My dear Sylvia" },
      { t: 281.9, text: "I cherish being with you" },
      { t: 284.9, text: "Your world is pure and beautiful." },
      { t: 287.9, text: "I want to love you well" },
      { t: 290.9, text: "And be better and stronger" },
      { t: 293.9, text: "Happy our first Valentine’s day" },
      { t: 296.9, text: "I LOVE YOU" },
    ];
    // ==========================

    const audio = document.getElementById("audio");
    const playBtn = document.getElementById("playBtn");
    const scrollBtn = document.getElementById("scrollBtn");
    const seek = document.getElementById("seek");
    const vol = document.getElementById("vol");
    const volIcon = document.getElementById("volIcon");
    const timeLabel = document.getElementById("timeLabel");
    const lyricsBox = document.getElementById("lyricsBox");
    // const status = document.getElementById("status");
    const songTitle = document.getElementById("songTitle");
    const songSub = document.getElementById("songSub");

    let autoScroll = true;
    let lastActiveIndex = -1;
    let userSeeking = false;
    let lastVolume = 0.9;

    songTitle.textContent = META.title;
    songSub.textContent = META.subtitle;

    function fmtTime(s) {
      if (!isFinite(s)) return "0:00";
      s = Math.max(0, Math.floor(s));
      const m = Math.floor(s / 60);
      const r = s % 60;
      return `${m}:${String(r).padStart(2, "0")}`;
    }

    // function setStatus(txt) {
    //   status.textContent = txt;
    // }

    function buildLyrics() {
      lyricsBox.innerHTML = "";
      LYRICS.forEach((line, i) => {
        const div = document.createElement("div");
        div.className = "line";
        div.dataset.index = String(i);
        div.dataset.time = String(line.t);
        div.textContent = line.text;
        div.addEventListener("click", () => {
          audio.currentTime = Math.max(0, line.t);
          if (audio.paused) audio.play().catch(() => {});
        });
        lyricsBox.appendChild(div);
      });
    }

    function activeLineIndex(t) {
      // Find last line with time <= t
      let lo = 0, hi = LYRICS.length - 1, ans = 0;
      while (lo <= hi) {
        const mid = (lo + hi) >> 1;
        if (LYRICS[mid].t <= t) { ans = mid; lo = mid + 1; }
        else { hi = mid - 1; }
      }
      return ans;
    }

    // Smooth scroll with easing
    let scrollAnimationId = null;
    function smoothScrollTo(element, target, duration = 600) {
      if (scrollAnimationId) cancelAnimationFrame(scrollAnimationId);

      const start = element.scrollTop;
      const distance = target - start;
      const startTime = performance.now();

      function easeOutCubic(t) {
        return 1 - Math.pow(1 - t, 3);
      }

      function animate(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);

        element.scrollTop = start + distance * easeOutCubic(progress);

        if (progress < 1) {
          scrollAnimationId = requestAnimationFrame(animate);
        } else {
          scrollAnimationId = null;
        }
      }

      scrollAnimationId = requestAnimationFrame(animate);
    }

    function updateLyrics(t) {
      if (!LYRICS.length) return;

      const idx = activeLineIndex(t);
      if (idx === lastActiveIndex) return;

      const children = lyricsBox.children;

      // Clear previous classes
      for (let i = 0; i < children.length; i++) {
        children[i].classList.remove("active", "near-1", "near-2");
      }

      // Apply proximity-based classes
      if (children[idx]) {
        children[idx].classList.add("active");

        // Adjacent lines get near-1 class
        if (children[idx - 1]) children[idx - 1].classList.add("near-1");
        if (children[idx + 1]) children[idx + 1].classList.add("near-1");

        // Lines 2 away get near-2 class
        if (children[idx - 2]) children[idx - 2].classList.add("near-2");
        if (children[idx + 2]) children[idx + 2].classList.add("near-2");

        if (autoScroll) {
          const lineEl = children[idx];
          const boxHeight = lyricsBox.clientHeight;
          const lineTop = lineEl.offsetTop;
          const lineHeight = lineEl.offsetHeight;
          const targetScroll = lineTop - (boxHeight / 2) + (lineHeight / 2);
          smoothScrollTo(lyricsBox, targetScroll, 500);
        }
      }
      lastActiveIndex = idx;
    }

    function updateSeek() {
      if (!audio.duration || userSeeking) return;
      const v = Math.round((audio.currentTime / audio.duration) * 1000);
      seek.value = String(Math.max(0, Math.min(1000, v)));
    }

    function updateTimeLabel() {
      timeLabel.textContent = `${fmtTime(audio.currentTime)} / ${fmtTime(audio.duration)}`;
    }

    // Events
    playBtn.addEventListener("click", async () => {
      if (audio.paused) {
        try {
          await audio.play();
        } catch (e) {
          // setStatus("Tap again to allow audio.");
          return;
        }
      } else {
        audio.pause();
      }
    });

    scrollBtn.addEventListener("click", () => {
      autoScroll = !autoScroll;
      scrollBtn.textContent = `Auto Scroll: ${autoScroll ? "On" : "Off"}`;
    });

    vol.addEventListener("input", () => {
      audio.volume = Number(vol.value);
      lastVolume = audio.volume > 0 ? audio.volume : lastVolume;
      updateVolIcon();
    });

    volIcon.addEventListener("click", () => {
      if (audio.volume > 0) {
        lastVolume = audio.volume;
        audio.volume = 0;
        vol.value = "0";
      } else {
        audio.volume = lastVolume;
        vol.value = String(lastVolume);
      }
      updateVolIcon();
    });

    function updateVolIcon() {
      if (audio.volume === 0) {
        volIcon.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 5L6 9H2v6h4l5 4V5z"/><line x1="23" y1="9" x2="17" y2="15"/><line x1="17" y1="9" x2="23" y2="15"/></svg>';
      } else if (audio.volume < 0.5) {
        volIcon.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 5L6 9H2v6h4l5 4V5z"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>';
      } else {
        volIcon.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 5L6 9H2v6h4l5 4V5z"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>';
      }
    }

    seek.addEventListener("pointerdown", () => { userSeeking = true; });
    seek.addEventListener("pointerup", () => { userSeeking = false; });

    seek.addEventListener("input", () => {
      if (!audio.duration) return;
      const ratio = Number(seek.value) / 1000;
      audio.currentTime = ratio * audio.duration;
      updateTimeLabel();
      updateLyrics(audio.currentTime);
    });

    audio.addEventListener("loadedmetadata", () => {
      // setStatus("Loaded");
      updateTimeLabel();
    });

    audio.addEventListener("play", () => {
      playBtn.textContent = "⏸";
      // setStatus("Playing");
    });

    audio.addEventListener("pause", () => {
      playBtn.textContent = "▶";
      // setStatus("Paused");
    });

    audio.addEventListener("timeupdate", () => {
      updateSeek();
      updateTimeLabel();
      updateLyrics(audio.currentTime);
    });

    audio.addEventListener("ended", () => {
      // setStatus("Finished");
      playBtn.textContent = "▶";
    });

    // Init
    buildLyrics();
    audio.volume = Number(vol.value);
    updateVolIcon();
    scrollBtn.textContent = "Auto Scroll: On";
  </script>
</body>
</html>
