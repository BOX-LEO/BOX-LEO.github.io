<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ü§ç26-214ü§ç</title>
  <style>
    :root{
      --bg:#0b0f1a;
      --card:#121a2a;
      --text:#e8eefc;
      --muted:#aab6d3;
      --accent:#ff7eb3;
      --line:rgba(255,255,255,.08);
    }
    *{ box-sizing:border-box; }

    @keyframes gradientFlow {
      0% {
        background-position: 0% 50%;
      }
      50% {
        background-position: 100% 50%;
      }
      100% {
        background-position: 0% 50%;
      }
    }

    body{
      margin:0;
      min-height:100vh;
      color:var(--text);
      background: url('assets/background.JPG') center center / cover no-repeat fixed;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.5);
      pointer-events: none;
      z-index: -1;
    }
    .wrap{
      max-width:640px;
      margin:0 auto;
      padding:28px 16px 40px;
      display:grid;
      gap:16px;
      grid-template-columns: 1fr;
    }
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius:18px;
      padding:18px;
      box-shadow: 0 20px 60px rgba(0,0,0,.35);
    }
    .card.top{
      padding:18px 14px;
    }
    header{
      display:flex;
      flex-direction:column;
      gap:8px;
      align-items:center;
      text-align:center;
    }
    .title{
      display:flex;
      flex-direction:column;
      gap:6px;
      align-items:center;
    }
    h1{
      margin:0;
      font-size:26px;
      letter-spacing:.3px;
    }
    .sub{
      margin:0;
      color:var(--muted);
      font-size:13px;
      line-height:1.4;
    }

    .top{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:14px;
    }

    .cover{
      display:none;
    }

    .lyrics-wrapper{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:14px;
      width:100%;
      max-width:600px;
    }

    .controls{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:center;
      flex-wrap:wrap;
    }
    button{
      appearance:none;
      border:1px solid var(--line);
      background:rgba(255,255,255,.06);
      color:var(--text);
      padding:10px 14px;
      border-radius:12px;
      cursor:pointer;
      font-weight:600;
      letter-spacing:.2px;
    }
    button:hover{ border-color:rgba(255,255,255,.18); }
    button:active{ transform: translateY(1px); }

    .pill{
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      color:var(--muted);
      font-size:12px;
      background:rgba(0,0,0,.12);
    }

    .row{
      display:flex;
      align-items:center;
      gap:10px;
      width:100%;
    }
    input[type="range"]{
      width:100%;
      accent-color: var(--accent);
    }
    .time{
      font-variant-numeric: tabular-nums;
      color:var(--muted);
      font-size:12px;
      min-width:92px;
      text-align:right;
    }

    .lyrics{
      height:420px;
      width:100%;
      overflow:auto;
      border-radius:16px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.12);
      padding:60px 12px;
      scrollbar-width:none;
      -ms-overflow-style:none;
      -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 15%, black 85%, transparent 100%);
      mask-image: linear-gradient(to bottom, transparent 0%, black 15%, black 85%, transparent 100%);
    }
    .lyrics::-webkit-scrollbar{
      display:none;
    }
    .line{
      padding:10px 10px;
      border-radius:12px;
      color:var(--muted);
      cursor:pointer;
      user-select:none;
      line-height:1.35;
      text-align:center;
      transition: background .3s, color .3s, transform .3s, opacity .4s;
      opacity: 0.4;
    }
    .line:hover{
      background:rgba(255,255,255,.05);
      color:rgba(232,238,252,.9);
      opacity: 0.8;
    }
    .line.active{
      background:rgba(255,126,179,.16);
      color:var(--text);
      border:1px solid rgba(255,126,179,.35);
      transform: scale(1.05);
      opacity: 1;
    }
    .line.near-1{
      opacity: 0.75;
    }
    .line.near-2{
      opacity: 0.55;
    }

    .footer{
      color:var(--muted);
      font-size:12px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    a{ color:var(--accent); text-decoration:none; }
    a:hover{ text-decoration:underline; }

    /* Fixed bottom player bar */
    .player-bar{
      position:fixed;
      bottom:16px;
      left:50%;
      transform:translateX(-50%);
      width:calc(100% - 32px);
      max-width:640px;
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius:18px;
      padding:14px 18px;
      backdrop-filter:blur(16px);
      -webkit-backdrop-filter:blur(16px);
      z-index:1000;
      box-shadow: 0 20px 60px rgba(0,0,0,.35);
    }
    .player-inner{
      display:flex;
      align-items:center;
      gap:16px;
    }
    .play-btn{
      width:48px;
      height:48px;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      background:var(--accent);
      border:none;
      color:#0b0f1a;
      font-size:18px;
      flex-shrink:0;
      transition: transform .1s, background .15s;
    }
    .play-btn:hover{
      background:#ff9ec4;
      transform:scale(1.05);
    }
    .player-progress{
      flex:1;
      display:flex;
      align-items:center;
      gap:12px;
      min-width:0;
    }
    .player-progress input[type="range"]{
      flex:1;
      min-width:80px;
    }
    .player-time{
      font-variant-numeric: tabular-nums;
      color:var(--muted);
      font-size:12px;
      min-width:90px;
      text-align:center;
    }
    .player-volume{
      display:flex;
      align-items:center;
      gap:8px;
      flex-shrink:0;
    }
    .player-volume input[type="range"]{
      width:80px;
    }
    .vol-icon{
      color:var(--muted);
      cursor:pointer;
      width:18px;
      height:18px;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-shrink:0;
    }
    .vol-icon svg{
      display:block;
    }
    @media (max-width: 600px){
      .player-inner{
        flex-wrap:wrap;
        gap:12px;
      }
      .player-progress{
        order:3;
        width:100%;
      }
      .player-volume input[type="range"]{
        width:50px;
      }
    }
    body{
      padding-bottom:90px;
    }
  </style>
</head>
<div id="particles-js" style="position:fixed; inset:0; z-index:-1;"></div>

<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
<script>
particlesJS("particles-js", {
  particles: {
    number: { value: 70 },
    size: { value: 2 },
    move: { speed: 1 },
    line_linked: { enable: true, opacity: 0.2 }
  }
});
</script>

<body>
  <div class="wrap">
    <div class="card">
      <header>
        <div class="title">
          <h1 id="songTitle">Our Song</h1>
          <p class="sub" id="songSub">A small website to play one song, with rolling lyrics.</p>
        </div>
        <!-- <div class="pill" id="status">Ready</div> -->
      </header>
    </div>

    <div class="card top">
      <div class="lyrics-wrapper">
        <div class="lyrics" id="lyricsBox" aria-label="Rolling lyrics"></div>
        <div class="controls">
          <button id="scrollBtn" type="button">Auto Scroll: On</button>
          <span class="pill" id="hint">Tip: click a lyric line to seek.</span>
        </div>
      </div>
      <!-- Audio element (hidden) -->
      <audio id="audio" preload="metadata">
        <source src="assets/song.mp3" type="audio/mpeg" />
      </audio>
    </div>

    <div class="card footer">
      <div>Happy our first Valentine‚Äôs day</div>
      <div>2026-02-14</div>
    </div>
  </div>

  <!-- Fixed bottom player bar -->
  <div class="player-bar">
    <div class="player-inner">
      <button id="playBtn" class="play-btn" type="button">‚ñ∂</button>
      <div class="player-progress">
        <input id="seek" type="range" min="0" max="1000" value="0" />
        <div class="player-time" id="timeLabel">0:00 / 0:00</div>
      </div>
      <div class="player-volume">
        <span class="vol-icon" id="volIcon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 5L6 9H2v6h4l5 4V5z"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg></span>
        <input id="vol" type="range" min="0" max="1" step="0.01" value="0.9" />
      </div>
    </div>
  </div>

  <script>
    // ====== 1) EDIT THESE ======
    const META = {
      title: "ü§çCode 26-214ü§ç",
      subtitle: "",
    };

    // Timestamps are in seconds.
    // Replace text with your lyrics.
    // Add more lines as you like.
    const LYRICS = [
      { t: 0.0,   text: "..." },
      { t: 11.9,  text: "‰∏ÄÁõ¥‰∏çÊï¢Âíå‰Ω†ÂØπËßÜ‰πü‰∏çÊï¢say Hi" },
      { t: 14.9,  text: "ÁúºÁ•û‰∏çÂÅúÈó™Ë∫≤Êó∂Èó¥ËøáÁöÑÈ£ûÂø´" },
      { t: 17.9,  text: "ËøòÊ≤°Âíå‰Ω†ËØ¥ËØùÂèØËÉΩÊ≥®ÂÆöÂ§±Ë¥•" },
      { t: 20.9,  text: "‰∏çÁü•Â¶Ç‰ΩïÊåΩÁïô‰Ω†Â∑≤ÁªèÂáÜÂ§áÁ¶ªÂºÄ" },
      { t: 23.9,  text: "ÈÇ£Â§©‰Ω†Ëµ∞ÂêéÊàëËÉΩÈáèÁû¨Èó¥ËÄóÂ∞Ω" },
      { t: 26.9,  text: "‰∏çÁü•‰Ω†ÈÇ£ÊôöÊúâÊ≤°ÊúâÁé©ÁöÑÂ∞ΩÂÖ¥" },
      { t: 29.9,  text: "ÊòéÊòéÊÉ≥Èù†Ëøë‰ΩÜ‰∏ÄÁõ¥ÁäπË±´‰∏çÂÅú" },
      { t: 32.9,  text: "Â§ö‰∫è‰Ω†ÁßÅ‰ø°ÊâçÊääÊàë‰ª¨Ë∑ùÁ¶ªÊãâËøë" },
      { t: 35.9,  text: "Êî∂Âà∞‰∫ÜÊ∂àÊÅØÊòØ‰Ω†Â§∏ÊàëË∂ÖÂ∏Ö" },
      { t: 38.9,  text: "ÊàëÂêë‰Ω†Âù¶ÁôΩÊúâ‰∫õÂøÉÊΩÆÊæéÊπÉ" },
      { t: 41.9,  text: "‰∏çÊÉ≥ÂÜçÈîôËøá‰Ω†ÁöÑÊØèÊù°Âä®ÊÄÅ" },
      { t: 44.9,  text: "Ê∏êÊ∏êÂºÄÂßãÂπªÊÉ≥ÊúâÂΩºÊ≠§ÁöÑÊú™Êù•" },
      { t: 47.9,  text: "ÈªòÈªòÂÖ≥Ê≥®‰Ω†ÁöÑ‰∏ªÈ°µ‰∏çÊÉ≥ËÆ©‰Ω†ÂèëÁé∞" },
      { t: 50.9,  text: "Á§æ‰∫§Â™í‰ΩìÁªô‰Ω†ÁßÅ‰ø°Ë∫≤Âú®Â±èÂπïÂêéÈù¢" },
      { t: 53.9,  text: "‰∏ãÊ¨°ÊºîÂá∫Â∞ΩÈáèÂá∫Áé∞ËøôÊòØ‰Ω†ÁöÑÁïôË®Ä" },
      { t: 56.9,  text: "Êó†Ê≥ïÊéßÂà∂ËÉ°ÊÄù‰π±ÊÉ≥ÊúüÂæÖ‰∏ãÊ¨°Áõ∏ËßÅ" },
      { t: 59.9,  text: "..." },
      { t: 71.9,  text: "Âú®Âè∞‰∏äÂæàÁ¥ßÂº†ÁúãÂà∞‰Ω†ÊàëÂ∞±ËÉΩÊîæÂøÉ" },
      { t: 74.9,  text: "ËÆ§ËØÜ‰Ω†Â§ßÂçäÂπ¥ÈÇ£Â§©Áªà‰∫éÂä†‰∏äÂæÆ‰ø°" },
      { t: 77.9,  text: "‰Ω†Ë∫´ÂΩ±Â§™Ëø∑‰∫∫Áû¨Èó¥Ê∑±Ê∑±ÂàªËøõÂøÉÈáå" },
      { t: 80.9,  text: "‰∏çÊÉ≥ÂæàÂø´ÊâøËÆ§Èù¢ÂØπ‰Ω†ÊàëÂ§±ÂéªËá™‰ø°" },
      { t: 83.9,  text: "Âê¨ËØ¥‰Ω†‰ºöÂèÇÂä†‰πãÂêéÁöÑËÅöÈ§ê" },
      { t: 86.9,  text: "ÊÉ≥Ë±°ÁùÄÂíå‰Ω†ÊâìÊãõÂëºÁöÑÁîªÈù¢" },
      { t: 89.9,  text: "ÂæàÂÆ≥ÊÄï‰∏çËá™ËßâË°®Áé∞ÁöÑ‰∏çÂÆâ" },
      { t: 92.9,  text: "Â§öÂ∏åÊúõÊúâÊú∫‰ºöÂ§öÁúã‰Ω†‰∏ÄÁúº" },
      { t: 95.9,  text: "Êó∂Èó¥‰∏ÄÂ§©‰∏ÄÂ§©Áªà‰∫éÂíå‰Ω†ËßÅÈù¢" },
      { t: 98.9,  text: "‰∏çÊÉ≥Ë¢´‰Ω†ÂèëÁé∞ÊàëÈó™Ë∫≤ÁöÑËßÜÁ∫ø" },
      { t: 101.9, text: "Áªô‰Ω†ÂÄíÊùØÊ©ôÊ±ÅÈöêËóèÂò¥ËßíÂºßÁ∫ø" },
      { t: 104.9, text: "Ê∏∏ÊàèÂä†ÈÄüÊó∂Èó¥ËΩ¨ÁúºÂ∑≤Âà∞‰∏âÁÇπ" },
      { t: 107.9, text: "..." },
      { t: 131.9, text: "ÈÇ£Â§©Ëµ∑Êàë‰ª¨ÁöÑÊ≤üÈÄöÂíå‰∫§ÊµÅÈÉΩ ÈÄêÊ∏êÂèòÂæóÈ¢ëÁπÅ" },
      { t: 134.9, text: "Âè™ÊÉ≥ËÆ©‰Ω†Â∞ΩÂø´‰∫ÜËß£Êàë‰∏çÂ∏∏ËßÅ ÊúÄÁúüÂÆûÁöÑ‰∏ÄÈù¢" },
      { t: 137.9, text: "ÊâÄÊúâËØù‰∏çÈöêËóè‰∏çÊé©È•∞‰∏çËØ¥Ë∞é Êúâ‰∫õÂè£Êó†ÈÅÆÊã¶" },
      { t: 140.9, text: "‰∏çÂÆ¢Â•ó‰∏çÊößÊòß‰∏çÂàªÊÑè‰∏çËôö‰º™ Â∏åÊúõ‰Ω†ËÉΩÂñúÊ¨¢" },
      { t: 143.9, text: "Yeah Yeah ‰∫ÜËß£Êù•Êó∂ÁöÑË∑Ø" },
      { t: 146.9, text: "Yeah Yeah ÂøÉ‰∫ãÂêë‰Ω†ÂÄæËØâ" },
      { t: 149.9, text: "Yeah Yeah ËØùÈ¢òÂèòÂæóÊ∑±ÂÖ•" },
      { t: 152.9, text: "ÂÜÖÂøÉ‰∏ñÁïå‰∏∞ÂØåÊòØ‰Ω†ÁâπÊúâÁöÑÂ§©Ëµã" },
      { t: 155.9, text: "‰∏ÄÁõ¥ÁõØÁùÄÊâãÊú∫Â±èÂπï‰∏çÈúÄË¶ÅÁù°ËßâÂêÉÈ•≠" },
      { t: 158.9, text: "Á≤æÁ•û‰∏ñÁïå‰øùÊåÅÂÖ±È∏£Âê¨‰Ω†Êé®ËçêÁöÑÊ≠åÂçï" },
      { t: 161.9, text: "‰øùÊåÅÁ∫ØÁ≤πÊ≤°ÊúâÊäÄÂ∑ßÂÖ®ÈÉΩÈù†ÁúüÊÉÖÂÆûÊÑü" },
      { t: 164.9, text: "ÂèØ‰ª•ÂãáÊï¢ÂÅöÊàëËá™Â∑±ËøôÂ∞±ÊòØÊñ∞ÁöÑËµ∑ÁÇπ" },
      { t: 167.9, text: "Êó©Â∞±ÊÉ≥ËØ¥‰Ω†ÁöÑÁúºÁùõÂæàËø∑‰∫∫" },
      { t: 170.9, text: "ÂÆÉË£ÖÁùÄ‰∏ñÈó¥‰∏áÁâ©ÂíåÊòüËæ∞" },
      { t: 173.9, text: "‰∏çÁü•‰∏çËßâ‰∏∫‰Ω†ÁÅµÈ≠ÇÊ≤âÊ≤¶" },
      { t: 176.9, text: "ÈáåÈù¢ÊòØÈ´òÊ¥ÅÁ∫ØÂáÄÁöÑÁ≤æÁ•û" },
      { t: 179.9, text: "Áü•ÈÅì‰Ω†‰∏çËÆ§Ë∑Ø Ê∑ªÂä†‰Ω†ÁöÑfindmy" },
      { t: 182.9, text: "‰∏çÂ∏åÊúõÊúâÊÑèÂ§ñ ÊéåÊè°‰Ω†ÁöÑÂä®ÊÄÅ" },
      { t: 185.9, text: "Êé•ÈÄÅÊú∫‰∫§ÁªôÊàë Ëà™Áè≠Âè∑ÈÉΩÊãøÊù•" },
      { t: 188.9, text: "ÁßòÂØÜÂºÄÂßãÁ≠ñÂàí ÊääÊàëÂÜÖÂøÉË°®ÁôΩ" },
      { t: 191.9, text: "..." },
      { t: 215.9, text: "Êàë‰∏ç‰ºöÈöèÈöè‰æø‰æøÂØπÂæÖ‰Ω†" },
      { t: 218.9, text: "‰πü‰∏çÊÉ≥‰Ω†Âèó‰∏ÄÁÇπÁÇπÂßîÂ±à" },
      { t: 221.9, text: "ÊØè‰∏™Êú™Êù•Ë∫´ËæπÁöÑ‰∫∫ÊòØ‰Ω†" },
      { t: 224.9, text: "Â§©ÂçóÂú∞ÂåóÂì™ÈáåÈÉΩÊòØÈ£éÊôØ" },
      { t: 227.9, text: "Ëå´Ëå´‰∫∫Êµ∑Áõ∏ÈÅá ‰∏âÁîüÊúâÂπ∏" },
      { t: 230.9, text: "Ê∏êÊ∏êÂºÄÂßãÁõ∏‰ø° ÂëΩ‰∏≠Ê≥®ÂÆö" },
      { t: 233.9, text: "Â∞äÈáçËá™Â∑±ÂÜÖÂøÉ Êó†ÊØîÁ°Æ‰ø°" },
      { t: 236.9, text: "Èùû‰Ω†Ëé´Â±ûÂõ†‰∏∫Êàë‰ª¨ÁÅµÈ≠ÇÁõ∏Â•ë" },
      { t: 239.9, text: "‰Ω†ÊúâÂèëÁé∞ÁæéÂ•ΩÁöÑÁúºÁùõ" },
      { t: 242.9, text: "‰πüÊúâÊ∏©Êöñ‰∏ñÁïåÁöÑÂøÉÁÅµ" },
      { t: 245.9, text: "‰Ω†Â§©ÁúüÊµ™Êº´ËøòÂæàÁêÜÊÄß" },
      { t: 248.9, text: "ÊàêÁÜüÂåÖË£πÈ≤úÊ¥ªÊ∏©Êüî‰∏îÂùöÂÆö" },
      { t: 251.9, text: "ÊÉÖÊ≠å‰∏çÂÜçËÇâÈ∫ªÂèòÊàêÁîüÊ¥ªÂÜôÁÖß" },
      { t: 254.9, text: "ÊàëÁü•ÈÅì‰Ω†Êâ´Ê∏ÖÊâÄÊúâÁöÑÈóÆÂè∑" },
      { t: 257.9, text: "ÊàëÊÉ≥Ë¶ÅÊú™Êù•ÈÉΩÊòØ‰Ω†ÁöÑÁæéË≤å" },
      { t: 260.9, text: "ÊÉ≥ÁÆÄÁÆÄÂçïÂçïÁà±Èô™‰Ω†‰∏ÄÁõ¥Âà∞ËÄÅ" },
      { t: 263.9, text: "‰ªäÂ§©ÊòØÊàë‰ª¨ËøáÁöÑÁ¨¨‰∏Ä‰∏™ÊÉÖ‰∫∫ËäÇ" },
      { t: 266.9, text: "Á¥ßÁ¥ßÁõ∏Êã•Â±û‰∫éÂΩºÊ≠§‰∏ç‰ºöÊúâÁ¶ªÂà´" },
      { t: 269.9, text: "Ê∏ÖÁàΩÈÄèÂΩªËá™Áî±Á∫ØÁ≤π‰øùÊåÅÂ§©ÁúüÊó†ÈÇ™" },
      { t: 272.9, text: "ÂÖ±Âêå‰π¶ÂÜô‰∏ìÂ±û‰Ω†ÊàëÁîúËúúÁöÑÊÉÖËäÇ" },
      { t: 275.9, text: "To My Destined Love" },
      { t: 278.9, text: "My Dear Sylvia" },
      { t: 281.9, text: "I cherish being with you" },
      { t: 284.9, text: "Your world is pure and beautiful." },
      { t: 287.9, text: "I want to love you well" },
      { t: 290.9, text: "And be better and stronger" },
      { t: 293.9, text: "Happy our first Valentine‚Äôs day" },
      { t: 296.9, text: "I LOVE YOU" },
    ];
    // ==========================

    const audio = document.getElementById("audio");
    const playBtn = document.getElementById("playBtn");
    const scrollBtn = document.getElementById("scrollBtn");
    const seek = document.getElementById("seek");
    const vol = document.getElementById("vol");
    const volIcon = document.getElementById("volIcon");
    const timeLabel = document.getElementById("timeLabel");
    const lyricsBox = document.getElementById("lyricsBox");
    // const status = document.getElementById("status");
    const songTitle = document.getElementById("songTitle");
    const songSub = document.getElementById("songSub");

    let autoScroll = true;
    let lastActiveIndex = -1;
    let userSeeking = false;
    let lastVolume = 0.9;

    songTitle.textContent = META.title;
    songSub.textContent = META.subtitle;

    function fmtTime(s) {
      if (!isFinite(s)) return "0:00";
      s = Math.max(0, Math.floor(s));
      const m = Math.floor(s / 60);
      const r = s % 60;
      return `${m}:${String(r).padStart(2, "0")}`;
    }

    // function setStatus(txt) {
    //   status.textContent = txt;
    // }

    function buildLyrics() {
      lyricsBox.innerHTML = "";
      LYRICS.forEach((line, i) => {
        const div = document.createElement("div");
        div.className = "line";
        div.dataset.index = String(i);
        div.dataset.time = String(line.t);
        div.textContent = line.text;
        div.addEventListener("click", () => {
          audio.currentTime = Math.max(0, line.t);
          if (audio.paused) audio.play().catch(() => {});
        });
        lyricsBox.appendChild(div);
      });
    }

    function activeLineIndex(t) {
      // Find last line with time <= t
      let lo = 0, hi = LYRICS.length - 1, ans = 0;
      while (lo <= hi) {
        const mid = (lo + hi) >> 1;
        if (LYRICS[mid].t <= t) { ans = mid; lo = mid + 1; }
        else { hi = mid - 1; }
      }
      return ans;
    }

    // Smooth scroll with easing
    let scrollAnimationId = null;
    function smoothScrollTo(element, target, duration = 600) {
      if (scrollAnimationId) cancelAnimationFrame(scrollAnimationId);

      const start = element.scrollTop;
      const distance = target - start;
      const startTime = performance.now();

      function easeOutCubic(t) {
        return 1 - Math.pow(1 - t, 3);
      }

      function animate(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);

        element.scrollTop = start + distance * easeOutCubic(progress);

        if (progress < 1) {
          scrollAnimationId = requestAnimationFrame(animate);
        } else {
          scrollAnimationId = null;
        }
      }

      scrollAnimationId = requestAnimationFrame(animate);
    }

    function updateLyrics(t) {
      if (!LYRICS.length) return;

      const idx = activeLineIndex(t);
      if (idx === lastActiveIndex) return;

      const children = lyricsBox.children;

      // Clear previous classes
      for (let i = 0; i < children.length; i++) {
        children[i].classList.remove("active", "near-1", "near-2");
      }

      // Apply proximity-based classes
      if (children[idx]) {
        children[idx].classList.add("active");

        // Adjacent lines get near-1 class
        if (children[idx - 1]) children[idx - 1].classList.add("near-1");
        if (children[idx + 1]) children[idx + 1].classList.add("near-1");

        // Lines 2 away get near-2 class
        if (children[idx - 2]) children[idx - 2].classList.add("near-2");
        if (children[idx + 2]) children[idx + 2].classList.add("near-2");

        if (autoScroll) {
          const lineEl = children[idx];
          const boxHeight = lyricsBox.clientHeight;
          const lineTop = lineEl.offsetTop;
          const lineHeight = lineEl.offsetHeight;
          const targetScroll = lineTop - (boxHeight / 2) + (lineHeight / 2);
          smoothScrollTo(lyricsBox, targetScroll, 500);
        }
      }
      lastActiveIndex = idx;
    }

    function updateSeek() {
      if (!audio.duration || userSeeking) return;
      const v = Math.round((audio.currentTime / audio.duration) * 1000);
      seek.value = String(Math.max(0, Math.min(1000, v)));
    }

    function updateTimeLabel() {
      timeLabel.textContent = `${fmtTime(audio.currentTime)} / ${fmtTime(audio.duration)}`;
    }

    // Events
    playBtn.addEventListener("click", async () => {
      if (audio.paused) {
        try {
          await audio.play();
        } catch (e) {
          // setStatus("Tap again to allow audio.");
          return;
        }
      } else {
        audio.pause();
      }
    });

    scrollBtn.addEventListener("click", () => {
      autoScroll = !autoScroll;
      scrollBtn.textContent = `Auto Scroll: ${autoScroll ? "On" : "Off"}`;
    });

    vol.addEventListener("input", () => {
      audio.volume = Number(vol.value);
      lastVolume = audio.volume > 0 ? audio.volume : lastVolume;
      updateVolIcon();
    });

    volIcon.addEventListener("click", () => {
      if (audio.volume > 0) {
        lastVolume = audio.volume;
        audio.volume = 0;
        vol.value = "0";
      } else {
        audio.volume = lastVolume;
        vol.value = String(lastVolume);
      }
      updateVolIcon();
    });

    function updateVolIcon() {
      if (audio.volume === 0) {
        volIcon.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 5L6 9H2v6h4l5 4V5z"/><line x1="23" y1="9" x2="17" y2="15"/><line x1="17" y1="9" x2="23" y2="15"/></svg>';
      } else if (audio.volume < 0.5) {
        volIcon.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 5L6 9H2v6h4l5 4V5z"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>';
      } else {
        volIcon.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 5L6 9H2v6h4l5 4V5z"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>';
      }
    }

    seek.addEventListener("pointerdown", () => { userSeeking = true; });
    seek.addEventListener("pointerup", () => { userSeeking = false; });

    seek.addEventListener("input", () => {
      if (!audio.duration) return;
      const ratio = Number(seek.value) / 1000;
      audio.currentTime = ratio * audio.duration;
      updateTimeLabel();
      updateLyrics(audio.currentTime);
    });

    audio.addEventListener("loadedmetadata", () => {
      // setStatus("Loaded");
      updateTimeLabel();
    });

    audio.addEventListener("play", () => {
      playBtn.textContent = "‚è∏";
      // setStatus("Playing");
    });

    audio.addEventListener("pause", () => {
      playBtn.textContent = "‚ñ∂";
      // setStatus("Paused");
    });

    audio.addEventListener("timeupdate", () => {
      updateSeek();
      updateTimeLabel();
      updateLyrics(audio.currentTime);
    });

    audio.addEventListener("ended", () => {
      // setStatus("Finished");
      playBtn.textContent = "‚ñ∂";
    });

    // Init
    buildLyrics();
    audio.volume = Number(vol.value);
    updateVolIcon();
    scrollBtn.textContent = "Auto Scroll: On";
  </script>
</body>
</html>
